#python3 compress_classifier.py -a=resnet32_cifar --pretrained -p=50 ../../../data.cifar10/ -j=12 --epochs=50 --lr=0.005 -b 128 --compress=../agp-pruning/resnet32_cifar_50spa.yaml --vs=0 

# Parameters:
# +----+-------------------------------------+----------------+---------------+----------------+------------+------------+----------+----------+----------+------------+---------+----------+------------+
# |    | Name                                | Shape          |   NNZ (dense) |   NNZ (sparse) |   Cols (%) |   Rows (%) |   Ch (%) |   2D (%) |   3D (%) |   Fine (%) |     Std |     Mean |   Abs-Mean |
# |----+-------------------------------------+----------------+---------------+----------------+------------+------------+----------+----------+----------+------------+---------+----------+------------|
# |  0 | module.conv1.weight                 | (16, 3, 3, 3)  |           432 |            432 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.12059 |  0.00092 |    0.09650 |
# |  1 | module.layer1.0.conv1.weight        | (16, 16, 3, 3) |          2304 |           2304 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.11954 |  0.00442 |    0.09530 |
# |  2 | module.layer1.0.conv2.weight        | (16, 16, 3, 3) |          2304 |           2304 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.11436 | -0.00070 |    0.09096 |
# |  3 | module.layer1.1.conv1.weight        | (16, 16, 3, 3) |          2304 |           2304 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.11400 |  0.00180 |    0.09132 |
# |  4 | module.layer1.1.conv2.weight        | (16, 16, 3, 3) |          2304 |           2304 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.11563 |  0.00362 |    0.09198 |
# |  5 | module.layer1.2.conv1.weight        | (16, 16, 3, 3) |          2304 |           2304 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.11688 | -0.00073 |    0.09358 |
# |  6 | module.layer1.2.conv2.weight        | (16, 16, 3, 3) |          2304 |           2304 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.11761 |  0.00212 |    0.09435 |
# |  7 | module.layer1.3.conv1.weight        | (16, 16, 3, 3) |          2304 |           2304 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.11620 | -0.00201 |    0.09265 |
# |  8 | module.layer1.3.conv2.weight        | (16, 16, 3, 3) |          2304 |           2304 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.11640 | -0.00105 |    0.09346 |
# |  9 | module.layer1.4.conv1.weight        | (16, 16, 3, 3) |          2304 |           2304 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.11929 | -0.00247 |    0.09505 |
# | 10 | module.layer1.4.conv2.weight        | (16, 16, 3, 3) |          2304 |           2304 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.11897 |  0.00200 |    0.09479 |
# | 11 | module.layer2.0.conv1.weight        | (32, 16, 3, 3) |          4608 |           4608 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08333 |  0.00018 |    0.06691 |
# | 12 | module.layer2.0.conv2.weight        | (32, 32, 3, 3) |          9216 |           9216 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08417 |  0.00007 |    0.06710 |
# | 13 | module.layer2.0.downsample.0.weight | (32, 16, 1, 1) |           512 |            512 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.25446 | -0.00249 |    0.20374 |
# | 14 | module.layer2.1.conv1.weight        | (32, 32, 3, 3) |          9216 |           9216 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08379 | -0.00146 |    0.06702 |
# | 15 | module.layer2.1.conv2.weight        | (32, 32, 3, 3) |          9216 |           9216 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08342 | -0.00164 |    0.06652 |
# | 16 | module.layer2.2.conv1.weight        | (32, 32, 3, 3) |          9216 |           9216 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08383 | -0.00127 |    0.06693 |
# | 17 | module.layer2.2.conv2.weight        | (32, 32, 3, 3) |          9216 |           9216 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08480 | -0.00093 |    0.06775 |
# | 18 | module.layer2.3.conv1.weight        | (32, 32, 3, 3) |          9216 |           9216 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08313 |  0.00078 |    0.06638 |
# | 19 | module.layer2.3.conv2.weight        | (32, 32, 3, 3) |          9216 |           9216 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08373 |  0.00124 |    0.06692 |
# | 20 | module.layer2.4.conv1.weight        | (32, 32, 3, 3) |          9216 |           9216 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08265 |  0.00111 |    0.06556 |
# | 21 | module.layer2.4.conv2.weight        | (32, 32, 3, 3) |          9216 |           9216 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08269 | -0.00128 |    0.06590 |
# | 22 | module.layer3.0.conv1.weight        | (64, 32, 3, 3) |         18432 |          18432 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05881 |  0.00040 |    0.04697 |
# | 23 | module.layer3.0.conv2.weight        | (64, 64, 3, 3) |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05890 | -0.00045 |    0.04702 |
# | 24 | module.layer3.0.downsample.0.weight | (64, 32, 1, 1) |          2048 |           2048 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.17807 |  0.00108 |    0.14368 |
# | 25 | module.layer3.1.conv1.weight        | (64, 64, 3, 3) |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05933 | -0.00048 |    0.04737 |
# | 26 | module.layer3.1.conv2.weight        | (64, 64, 3, 3) |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05897 | -0.00024 |    0.04698 |
# | 27 | module.layer3.2.conv1.weight        | (64, 64, 3, 3) |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05884 |  0.00049 |    0.04697 |
# | 28 | module.layer3.2.conv2.weight        | (64, 64, 3, 3) |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05892 | -0.00018 |    0.04691 |
# | 29 | module.layer3.3.conv1.weight        | (64, 64, 3, 3) |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05912 | -0.00041 |    0.04713 |
# | 30 | module.layer3.3.conv2.weight        | (64, 64, 3, 3) |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05914 | -0.00007 |    0.04721 |
# | 31 | module.layer3.4.conv1.weight        | (64, 64, 3, 3) |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05865 |  0.00004 |    0.04674 |
# | 32 | module.layer3.4.conv2.weight        | (64, 64, 3, 3) |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05907 |  0.00035 |    0.04701 |
# | 33 | module.fc.weight                    | (10, 64)       |           640 |            640 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.07261 |  0.00044 |    0.06296 |
# | 34 | Total sparsity:                     | -              |        464432 |         464432 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.00000 |  0.00000 |    0.00000 |
# +----+-------------------------------------+----------------+---------------+----------------+------------+------------+----------+----------+----------+------------+---------+----------+------------+
# Total sparsity: 0.00

version: 1

pruners:

  conv_pruner:
    class: AutomatedGradualPruner
    initial_sparsity : 0.05
    final_sparsity: 0.50
    weights: [
      #module.conv1.weight,        
      module.layer1.0.conv1.weight,       
      module.layer1.0.conv2.weight,       
      module.layer1.1.conv1.weight,       
      module.layer1.1.conv2.weight,       
      module.layer1.2.conv1.weight,       
      module.layer1.2.conv2.weight,       
      module.layer1.3.conv1.weight,       
      module.layer1.3.conv2.weight,       
      module.layer1.4.conv1.weight,       
      module.layer1.4.conv2.weight,       
      module.layer2.0.conv1.weight,       
      module.layer2.0.conv2.weight,       
      module.layer2.0.downsample.0.weight,
      module.layer2.1.conv1.weight,       
      module.layer2.1.conv2.weight,       
      module.layer2.2.conv1.weight,       
      module.layer2.2.conv2.weight,       
      module.layer2.3.conv1.weight,       
      module.layer2.3.conv2.weight,       
      module.layer2.4.conv1.weight,       
      module.layer2.4.conv2.weight,       
      module.layer3.0.conv1.weight,       
      module.layer3.0.conv2.weight,       
      module.layer3.0.downsample.0.weight,
      module.layer3.1.conv1.weight,       
      module.layer3.1.conv2.weight,       
      module.layer3.2.conv1.weight,       
      module.layer3.2.conv2.weight,       
      module.layer3.3.conv1.weight,       
      module.layer3.3.conv2.weight,       
      module.layer3.4.conv1.weight       
      #module.layer3.4.conv2.weight,       
      #module.fc.weight 
    ]

                  

lr_schedulers:
   pruning_lr:
     class: ExponentialLR
     gamma: 0.95


policies:
  - pruner:
      instance_name : conv_pruner
    starting_epoch: 0
    ending_epoch: 25
    frequency: 1

  - lr_scheduler:
      instance_name: pruning_lr
    starting_epoch: 26
    ending_epoch: 50
    frequency: 1
