# Schedule based on:
#   Learning Efficient Convolutional Networks through Network Slimming
#   Zhuang Liu, Jianguo Li, Zhiqiang Shen, Gao Huang, Shoumeng Yan, Changshui Zhang
#   arXiv:1708.06519v1
#   Aug 2017
#
# time python3 compress_classifier.py --arch resnet34  --dataset=cifar10_resize ../../../data.cifar10 -p=50 -b 128 --lr=0.3 --epochs=180 --compress=../network_slimming/resnet34_slimming.yaml --resume-from ../../../resnet_dense_cifar10/checkpoint.pth.tar -j=30 -n resnet34_cifar10_slimming_50spa


# Parameters:
# +----+-------------------------------------+------------------+---------------+----------------+------------+------------+----------+----------+----------+------------+---------+----------+------------+
# |    | Name                                | Shape            |   NNZ (dense) |   NNZ (sparse) |   Cols (%) |   Rows (%) |   Ch (%) |   2D (%) |   3D (%) |   Fine (%) |     Std |     Mean |   Abs-Mean |
# |----+-------------------------------------+------------------+---------------+----------------+------------+------------+----------+----------+----------+------------+---------+----------+------------|
# |  0 | module.conv1.weight                 | (64, 3, 7, 7)    |          9408 |           9408 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02526 |  0.00015 |    0.02022 |
# |  1 | module.layer1.0.conv1.weight        | (64, 64, 3, 3)   |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05891 |  0.00002 |    0.04701 |
# |  2 | module.layer1.0.conv2.weight        | (64, 64, 3, 3)   |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05900 |  0.00065 |    0.04713 |
# |  3 | module.layer1.1.conv1.weight        | (64, 64, 3, 3)   |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05880 | -0.00023 |    0.04693 |
# |  4 | module.layer1.1.conv2.weight        | (64, 64, 3, 3)   |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05897 |  0.00049 |    0.04702 |
# |  5 | module.layer1.2.conv1.weight        | (64, 64, 3, 3)   |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05910 | -0.00058 |    0.04709 |
# |  6 | module.layer1.2.conv2.weight        | (64, 64, 3, 3)   |         36864 |          36864 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.05889 | -0.00003 |    0.04699 |
# |  7 | module.layer2.0.conv1.weight        | (128, 64, 3, 3)  |         73728 |          73728 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.04172 |  0.00003 |    0.03329 |
# |  8 | module.layer2.0.conv2.weight        | (128, 128, 3, 3) |        147456 |         147456 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.04163 |  0.00000 |    0.03315 |
# |  9 | module.layer2.0.downsample.0.weight | (128, 64, 1, 1)  |          8192 |           8192 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.12250 | -0.00111 |    0.09737 |
# | 10 | module.layer2.1.conv1.weight        | (128, 128, 3, 3) |        147456 |         147456 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.04161 | -0.00003 |    0.03318 |
# | 11 | module.layer2.1.conv2.weight        | (128, 128, 3, 3) |        147456 |         147456 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.04170 |  0.00009 |    0.03329 |
# | 12 | module.layer2.2.conv1.weight        | (128, 128, 3, 3) |        147456 |         147456 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.04172 | -0.00020 |    0.03327 |
# | 13 | module.layer2.2.conv2.weight        | (128, 128, 3, 3) |        147456 |         147456 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.04174 |  0.00008 |    0.03334 |
# | 14 | module.layer2.3.conv1.weight        | (128, 128, 3, 3) |        147456 |         147456 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.04162 |  0.00010 |    0.03320 |
# | 15 | module.layer2.3.conv2.weight        | (128, 128, 3, 3) |        147456 |         147456 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.04156 | -0.00002 |    0.03318 |
# | 16 | module.layer3.0.conv1.weight        | (256, 128, 3, 3) |        294912 |         294912 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02948 |  0.00007 |    0.02352 |
# | 17 | module.layer3.0.conv2.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02953 | -0.00001 |    0.02356 |
# | 18 | module.layer3.0.downsample.0.weight | (256, 128, 1, 1) |         32768 |          32768 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.08802 |  0.00030 |    0.07008 |
# | 19 | module.layer3.1.conv1.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02946 |  0.00004 |    0.02350 |
# | 20 | module.layer3.1.conv2.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02947 | -0.00001 |    0.02350 |
# | 21 | module.layer3.2.conv1.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02947 | -0.00003 |    0.02351 |
# | 22 | module.layer3.2.conv2.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02946 | -0.00003 |    0.02350 |
# | 23 | module.layer3.3.conv1.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02947 | -0.00007 |    0.02352 |
# | 24 | module.layer3.3.conv2.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02948 | -0.00003 |    0.02353 |
# | 25 | module.layer3.4.conv1.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02946 | -0.00006 |    0.02349 |
# | 26 | module.layer3.4.conv2.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02949 | -0.00002 |    0.02353 |
# | 27 | module.layer3.5.conv1.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02944 |  0.00009 |    0.02349 |
# | 28 | module.layer3.5.conv2.weight        | (256, 256, 3, 3) |        589824 |         589824 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02943 |  0.00005 |    0.02348 |
# | 29 | module.layer4.0.conv1.weight        | (512, 256, 3, 3) |       1179648 |        1179648 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02084 |  0.00002 |    0.01663 |
# | 30 | module.layer4.0.conv2.weight        | (512, 512, 3, 3) |       2359296 |        2359296 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02082 |  0.00001 |    0.01662 |
# | 31 | module.layer4.0.downsample.0.weight | (512, 256, 1, 1) |        131072 |         131072 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.06246 |  0.00022 |    0.04987 |
# | 32 | module.layer4.1.conv1.weight        | (512, 512, 3, 3) |       2359296 |        2359296 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02085 |  0.00001 |    0.01663 |
# | 33 | module.layer4.1.conv2.weight        | (512, 512, 3, 3) |       2359296 |        2359296 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02084 | -0.00000 |    0.01662 |
# | 34 | module.layer4.2.conv1.weight        | (512, 512, 3, 3) |       2359296 |        2359296 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02085 | -0.00001 |    0.01663 |
# | 35 | module.layer4.2.conv2.weight        | (512, 512, 3, 3) |       2359296 |        2359296 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02083 | -0.00000 |    0.01662 |
# | 36 | module.fc.weight                    | (1000, 512)      |        512000 |         512000 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.02553 |  0.00001 |    0.02211 |
# | 37 | Total sparsity:                     | -                |      21779648 |       21779648 |    0.00000 |    0.00000 |  0.00000 |  0.00000 |  0.00000 |    0.00000 | 0.00000 |  0.00000 |    0.00000 |
# +----+-------------------------------------+------------------+---------------+----------------+------------+------------+----------+----------+----------+------------+---------+----------+------------+
# Total sparsity: 0.00

lr_schedulers:
  training_lr:
    class: StepLR
    step_size: 45
    gamma: 0.10

regularizers:
  Channels_groups_regularizer:
    class: L1Regularizer
    reg_regims:   
      #module.conv1.weight  
      module.layer1.0.bn2.weight: 0.005
      module.layer1.1.bn2.weight: 0.005
      module.layer1.2.bn2.weight: 0.005
      module.layer2.0.bn2.weight: 0.005
      module.layer2.1.bn2.weight: 0.005
      module.layer2.2.bn2.weight: 0.005
      module.layer2.3.bn2.weight: 0.005
      module.layer3.0.bn2.weight: 0.005
      module.layer3.1.bn2.weight: 0.005
      module.layer3.2.bn2.weight: 0.005
      module.layer3.3.bn2.weight: 0.005
      module.layer3.4.bn2.weight: 0.005
      module.layer3.5.bn2.weight: 0.005
      module.layer4.0.bn2.weight: 0.005
      module.layer4.1.bn2.weight: 0.005
      module.layer4.2.bn2.weight: 0.005

policies:
  - lr_scheduler:
      instance_name: training_lr
    starting_epoch: 45
    ending_epoch: 300
    frequency: 1

  - regularizer:
      instance_name: Channels_groups_regularizer
    starting_epoch: 0
    ending_epoch: 180
    frequency: 1
